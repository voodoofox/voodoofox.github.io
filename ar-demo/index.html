<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MindAR Web-AR Demo</title>

  <!-- ① Patch getUserMedia to force the back (environment) camera -->
  <script>
    (function(){
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return;
      const orig = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
      navigator.mediaDevices.getUserMedia = function(constraints){
        if (constraints && constraints.video) {
          constraints.video = Object.assign(
            {},
            constraints.video === true ? {} : constraints.video,
            { facingMode: { exact: "environment" } }
          );
        }
        return orig(constraints);
      };
    })();
  </script>

  <!-- ② A-Frame core engine -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- ③ MindAR image-tracking extension -->
  <script src="https://cdn.jsdelivr.net/npm/mind-ar/dist/mindar-image-aframe.prod.js"></script>

  <style>
    /* full-viewport & cover the camera feed */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    a-scene {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    a-scene canvas {
      object-fit: cover !important;
      width: 100% !important;
      height: 100% !important;
    }
  </style>
</head>

<body>
  <a-scene
    mindar-image="
      imageTargetSrc: ./assets/poster.mind;
      maxTrack: 1;
      warmupTolerance: 1;
      missTolerance: 1;
      filterMinCF: 0.0001;
      filterBeta: 10000;
    "
    embedded
  >
    <!-- Ambient + directional lights so your model is visible -->
    <a-entity light="type: ambient; intensity: 0.5"></a-entity>
    <a-entity light="type: directional; intensity: 0.8" position="0 1 0"></a-entity>

    <a-assets>
      <!-- If you want your GLB model instead of the box, uncomment below 
      <a-asset-item id="ship" src="./assets/ship.glb"></a-asset-item>
      -->
    </a-assets>

    <a-entity mindar-image-target="targetIndex: 0">
      <!-- Test box: sits flush on the poster and peeks out toward camera -->
      <a-box
        width="0.2" height="0.2" depth="0.2"
        color="red"
        position="0 0.1 -0.05">
      </a-box>

      <!-- Replace the box with your model by uncommenting:
      <a-gltf-model
        src="#ship"
        position="0 0 0.1"
        rotation="0 0 0"
        scale="0.3 0.3 0.3">
      </a-gltf-model>
      -->
    </a-entity>

    <a-camera look-controls></a-camera>
  </a-scene>
</body>
</html>
